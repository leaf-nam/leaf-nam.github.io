<!doctype html><html lang=ko dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Java]Spring Security(With TDD) JWT 라이브러리 활용해서 간편하게 구현하기 | 봄을 기다리는 낙엽</title>
<meta name=keywords content="authentication,jwt"><meta name=description content="JWT를 통한 인증을 oauth2-resource-server를 활용해서 간편하게 구현합니다."><meta name=author content="Leaf"><link rel=canonical href=https://leaf-nam.github.io/posts/spring_security/6/><meta name=google-site-verification content="l76eAEMadEn1QzS8fLTbrl8ppayZprvV3uuAbMGSy_c"><meta name=msvalidate.01 content="XYZabc"><meta name=naver-site-verification content="adff811404d441495a954e30579f40297ba14f5e"><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=https://leaf-nam.github.io/favicon.svg><link rel=icon type=image/png sizes=16x16 href=https://leaf-nam.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://leaf-nam.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://leaf-nam.github.io/apple-touch-icon.png><link rel=mask-icon href=https://leaf-nam.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ko href=https://leaf-nam.github.io/posts/spring_security/6/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-9PNFP00SSG"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9PNFP00SSG")}</script><meta property="og:url" content="https://leaf-nam.github.io/posts/spring_security/6/"><meta property="og:site_name" content="봄을 기다리는 낙엽"><meta property="og:title" content="[Java]Spring Security(With TDD) JWT 라이브러리 활용해서 간편하게 구현하기"><meta property="og:description" content="JWT를 통한 인증을 oauth2-resource-server를 활용해서 간편하게 구현합니다."><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-14T23:26:49+09:00"><meta property="article:modified_time" content="2024-12-14T23:26:49+09:00"><meta property="article:tag" content="Authentication"><meta property="article:tag" content="Jwt"><meta property="og:image" content="https://leaf-nam.github.io/posts/spring_security/6/coverage.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://leaf-nam.github.io/posts/spring_security/6/coverage.png"><meta name=twitter:title content="[Java]Spring Security(With TDD) JWT 라이브러리 활용해서 간편하게 구현하기"><meta name=twitter:description content="JWT를 통한 인증을 oauth2-resource-server를 활용해서 간편하게 구현합니다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://leaf-nam.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Spring Security 파헤치기","item":"https://leaf-nam.github.io/posts/spring_security/"},{"@type":"ListItem","position":3,"name":"[Java]Spring Security(With TDD) JWT 라이브러리 활용해서 간편하게 구현하기","item":"https://leaf-nam.github.io/posts/spring_security/6/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Java]Spring Security(With TDD) JWT 라이브러리 활용해서 간편하게 구현하기","name":"[Java]Spring Security(With TDD) JWT 라이브러리 활용해서 간편하게 구현하기","description":"JWT를 통한 인증을 oauth2-resource-server를 활용해서 간편하게 구현합니다.","keywords":["authentication","jwt"],"articleBody":"도입 지난 포스팅 [Java]Spring Security WebMVC 기본 구조 [Java]Spring Security 예외처리, 캐싱, 로깅 [Java]Spring Security 인증(Authentication)과 인가(Authorization) [Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기 [Java]Spring Security(With TDD) JWT 직접 구현하기 저번 시간에는 JWT의 인증 필터를 직접 구현해서 인증 로직을 완성했습니다.\n이번 시간에는 Spring에서 제공하는 oauth2-resource-server 라이브러리를 통해 동일한 인증 로직을 구현해보겠습니다.\n설계 요구사항 분석 요구 사항은 지난 포스트와 동일합니다.\n로그인 실패 시 jwt를 발행하지 않는다. 정상 로그인 시 jwt를 발행한다.(Happy Case) 잘못된 jwt로 인증할 수 없다. 권한이 부족한 jwt에 인가할 수 없다. 정상적인 jwt로 특정 권한의 api를 사용할 수 있다.(Happy Case) 통합 테스트 통합 테스트도 지난 시간에 사용한 것을 그대로 사용하겠습니다.\n다만, 기존 테스트와 URL 기반으로 요청을 분리하기 위해 다음과 같이 일부 테스트 코드를 변경하였습니다. 테스트에 사용할 SecurityConfig를 JwtSecurityConfig에서 JwtSecurityConfigV2로 변경합니다. 요청 URL을 /jwt/**에서 /jwt/v2/**로 변경합니다. package com.springsecurity.jwt.integration; /* 생략 */ @ExtendWith(SpringExtension.class) // SecurityConfig 변경 @ContextConfiguration(classes = JwtSecurityConfigV2.class) @WebAppConfiguration @Import(IntegrationTestConfig.class) public class JWTIntegrationV2Test { MockMvc mockMvc; JwtUtil jwtUtil; @Autowired WebApplicationContext context; @BeforeEach void init() { jwtUtil = new JwtUtil(); mockMvc = MockMvcBuilders.webAppContextSetup(context) .apply(springSecurity()).build(); } @Test @DisplayName(\"1. 로그인 실패 시 jwt를 발행하지 않는다.\") void testLoginFailure() throws Exception { // given : 유저와 관리자 아이디, 잘못된 패스워드 String userId = \"user\", adminId = \"admin\"; String password = \"badPassword\"; // when : 사용자 토큰 발급 시도 mockMvc.perform(post(\"/jwt/v2/token\") .param(\"username\", userId) .param(\"password\", password)) // then : 401(Unauthenticated) 오류 .andExpect(status().is(401)); // when : 관리자 토큰 발급 시도 mockMvc.perform(post(\"/jwt/v2/token\") .param(\"username\", adminId) .param(\"password\", password)) // then : 401(Unauthenticated) 오류 .andExpect(status().is(401)); } @Test @DisplayName(\"2. 정상 로그인 시 jwt를 발행한다.(Happy Case)\") void testLoginSuccess() throws Exception { // given : 유저와 관리자 아이디, 패스워드 String userId = \"user\", adminId = \"admin\"; String userPass = \"user1234\", adminPass = \"admin1234\"; // when : 토큰 발급 String userToken = mockMvc.perform(post(\"/jwt/v2/token\") .param(\"username\", userId).param(\"password\", userPass)) .andExpect(status().is(200)) .andReturn().getResponse().getContentAsString(); String adminToken = mockMvc.perform(post(\"/jwt/v2/token\") .param(\"username\", adminId).param(\"password\", adminPass)) .andExpect(status().is(200)) .andReturn().getResponse().getContentAsString(); // then : 정상 토큰여부 확인(JwtUtil) jwtUtil.validate(userToken); jwtUtil.validate(adminToken); } @Test @DisplayName(\"3. 잘못된 jwt로 인증할 수 없다.\") void testAuthentication() throws Exception { // given : 잘못된 jwt 토큰 String badToken = \"bearer asdf1234\"; // when : User API 접근 mockMvc.perform(get(\"/jwt/v2/user/resources\") .header(HttpHeaders.AUTHORIZATION, badToken)) // then : 401 오류 .andExpect(status().is(401)); } @Test @DisplayName(\"4. 권한이 부족한 jwt에 인가할 수 없다.\") void testAuthorization() throws Exception { // given : USER 권한 String role = \"ROLE_USER\"; // when : Admin API 접근 mockMvc.perform(get(\"/jwt/v2/admin/resources\") .with(jwt().authorities(new SimpleGrantedAuthority(role)))) // then : 403(Forbidden) 오류 .andExpect(status().is(403)); } @Test @DisplayName(\"5. 정상적인 jwt로 특정 권한의 api를 사용할 수 있다.`(Happy Case)`\") void testHappyCase() throws Exception { // given : ADMIN 권한 String role = \"ROLE_ADMIN\"; // 권한 없이 PUBLIC API 접근 mockMvc.perform(get(\"/jwt/v2/public/resources\")) .andExpect(status().is(200)); // Admin 권한으로 USER API 접근 mockMvc.perform(get(\"/jwt/v2/user/resources\") .with(jwt().authorities(new SimpleGrantedAuthority(role)))) .andExpect(status().is(200)); // Admin 권한으로 Admin API 접근 mockMvc.perform(get(\"/jwt/v2/admin/resources\") .with(jwt().authorities(new SimpleGrantedAuthority(role)))) .andExpect(status().is(200)); } } 위와 같이 Spring Security 설정을 변경 후, 컴파일 오류를 해결하기 위해 다음과 같이 임시로 JwtSecurityConfigV2를 생성합니다. package com.springsecurity.jwt.config; public class JwtSecurityConfigV2 { } 이제 테스트를 실행하면 다음과 같이 모든 테스트가 실패합니다. 실패 메시지를 확인해보면, springSecurityFilterChain cannot be null. 이라는 메시지를 확인할 수 있습니다. MockMVC를 초기화하는 과정에서 SpringSecurity를 실행할 때 필수적인 bean인 springSecurityFilterChain이 Spring에 등록되어 있지 않기 때문입니다. 아직 해당 설정파일에 아무것도 작성하지 않았기 때문에 당연한 결과입니다.\n구현 라이브러리 가져오기 우선, oauth2-resource-server1를 사용하기 위해 다음과 같이 build.gradle에 의존성을 주입합니다.\n// build.gradle dependencies { implementation 'org.springframework.boot:spring-boot-starter-security' implementation 'org.springframework.boot:spring-boot-starter-web' // 의존성 추가 implementation 'org.springframework.boot:spring-boot-starter-oauth2-resource-server' /* 생략 */ } JwtSecurityConfigV2 구현 이후, 기존에 통합테스트를 실행하기 위해 클래스만 생성해 두었던 JwtSecurityConfigV2에 다음과 같이 설정합니다.\nSecurityMatcher URL 설정 : JwtSecurityConfig와 URL기반으로 설정을 분리하기 위함입니다. CSRF 토큰 해제 : 해당 옵션을 해제하지 않고 JWT 로그인 시 CSRF 토큰이 없으면 오류가 발생할 수 있습니다. JWT는 stateless한 인증 방식이기 때문에 CSRF토큰을 구현하기가 제한됩니다. Session Management 해제 : JWT는 Session 방식을 사용하지 않기 때문에 이를 해제해주어야 세션 정보를 서버에 별도로 저장하지 않습니다. 권한별 인가 로직 작성 : API별 필요한 권한을 명시합니다. CustomAuthenticationEntryPoint 등록 : 저번에 생성한 해당 클래스를 ExceptionHandler로 등록해야 인증 실패 시 302오류가 발생하지 않습니다. 지난 시간에 생성한 JwtSecurityConfig설정과 대부분 동일하지만, 요청 URL을 다르게 설정하기 때문에 두 필터가 모두 SecurityFilterChain에 등록되어 각각 적용됩니다.\npackage com.springsecurity.jwt.config; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer; import org.springframework.security.config.http.SessionCreationPolicy; import org.springframework.security.web.SecurityFilterChain; @Configuration @EnableWebSecurity public class JwtSecurityConfigV2 { @Bean public SecurityFilterChain jwtFilterChainV2(HttpSecurity http, CustomAuthenticationEntryPoint customAuthenticationEntryPoint) throws Exception { return http .securityMatcher(\"/jwt/v2/**\") .csrf(AbstractHttpConfigurer::disable) .sessionManagement(session -\u003e session.sessionCreationPolicy(SessionCreationPolicy.STATELESS)) .authorizeHttpRequests(authorize -\u003e authorize .requestMatchers(\"/jwt/v2/public/**\").permitAll() .requestMatchers(\"/jwt/v2/user/**\").hasRole(\"USER\") .requestMatchers(\"/jwt/v2/admin/**\").hasRole(\"ADMIN\") .requestMatchers(\"/jwt/v2/token\").permitAll() .anyRequest().authenticated()) .exceptionHandling(handler -\u003e handler .authenticationEntryPoint(customAuthenticationEntryPoint)) .build(); } } 이제 테스트를 수행하면 다음과 같이 3번 테스트만 성공합니다.\n해당 API의 Controller를 구현하지 않았기 때문에 404오류가 발생합니다.\nAPI 구현 지난 시간과 마찬가지로, 다음과 같이 JwtApiControllerV2에 모든 API 를 생성하겠습니다.\npackage com.springsecurity.jwt.api; import com.springsecurity.jwt.Role; import com.springsecurity.jwt.utility.JwtUtil; import lombok.RequiredArgsConstructor; import org.springframework.http.HttpStatus; import org.springframework.http.ResponseEntity; import org.springframework.web.bind.annotation.*; @RestController @RequiredArgsConstructor @RequestMapping(\"/jwt/v2\") public class JwtApiControllerV2 { private final JwtUtil jwtUtil; @GetMapping(\"/admin/resources\") public String getAdminResources() { return \"ADMIN 자원 획득\"; } @GetMapping(\"/user/resources\") public String getUserResources() { return \"USER 자원 획득\"; } @GetMapping(\"/public/resources\") public String getPublicResources() { return \"PUBLIC 자원 획득\"; } @PostMapping(\"/token\") public ResponseEntity\u003cString\u003e getToken(@RequestParam String username, @RequestParam String password) { if (username.equals(\"user\") \u0026\u0026 password.equals(\"user1234\")) return new ResponseEntity\u003c\u003e(jwtUtil.issue(\"user\", Role.USER.name()), HttpStatus.OK); if (username.equals(\"admin\") \u0026\u0026 password.equals(\"admin1234\")) return new ResponseEntity\u003c\u003e(jwtUtil.issue(\"admin\", Role.ADMIN.name()), HttpStatus.OK); return new ResponseEntity\u003c\u003e(HttpStatus.UNAUTHORIZED); } } 해당 Controller를 통합 테스트에 사용하기 위해 다음과 같이 IntegrationTestConfig를 수정합니다.\n해당 클래스는 이전 포스트에서 통합 테스트 시 필요한 설정과 의존관계를 한번에 불러오기 위해 별도로 분리한 설정파일입니다.\npackage com.springsecurity.jwt.config; /* 생략 */ @Configuration //JwtApiControllerV2 추가 @Import({JwtApiControllerV2.class, JwtApiController.class, JwtUtil.class, JwtAuthenticationFilter.class, CustomAuthenticationEntryPoint.class}) public class IntegrationTestConfig { @Bean(name = \"mvcHandlerMappingIntrospector\") public HandlerMappingIntrospector mvcHandlerMappingIntrospector() { return new HandlerMappingIntrospector(); } @Bean(autowireCandidate = false) public static RoleHierarchy testRoleHierarchy() { return RoleHierarchyImpl.withDefaultRolePrefix() .role(\"ADMIN\").implies(\"USER\") .build(); } } 이제, 다음과 같이 jwt 발행 관련 로직이 모두 성공합니다.\n나머지 테스트에서는 아직 JWT를 활용한 인증 로직이 적용되지 않았기 때문에 401 오류가 발생합니다.\nDecoder, Converter 구현 토큰 인증을 도입하기 위해서는 Decoder와 Converter가 필요합니다.\nDecoder : Authorization 헤더에 있는 Bearer + 'accessToken'형태의 토큰을 복호화하여 유효성 검증과 함께 내부의 권한을 체크합니다. Converter : 복호화된 토큰에서 권한을 찾아서 grantedAuthorities에 등록합니다. 다음과 같이 JwtSecurityConfigV2 내부에 이를 구현하겠습니다.\npackage com.springsecurity.jwt.config; /* 생략 */ @Configuration @EnableWebSecurity public class JwtSecurityConfigV2 { @Bean public SecurityFilterChain jwtFilterChainV2(HttpSecurity http, CustomAuthenticationEntryPoint customAuthenticationEntryPoint) throws Exception { return http .securityMatcher(\"/jwt/v2/**\") .csrf(AbstractHttpConfigurer::disable) .sessionManagement(session -\u003e session.sessionCreationPolicy(SessionCreationPolicy.STATELESS)) // OAuth2ResourceServer 사용하도록 FilterChain 등록 .oauth2ResourceServer(oauth2 -\u003e oauth2.jwt(Customizer.withDefaults())) .authorizeHttpRequests(authorize -\u003e authorize .requestMatchers(\"/jwt/v2/public/**\").permitAll() .requestMatchers(\"/jwt/v2/user/**\").hasRole(\"USER\") .requestMatchers(\"/jwt/v2/admin/**\").hasRole(\"ADMIN\") .requestMatchers(\"/jwt/v2/token\").permitAll() .anyRequest().authenticated()) .exceptionHandling(handler -\u003e handler .authenticationEntryPoint(customAuthenticationEntryPoint)) .build(); } // Decoder 등록 @Bean JwtDecoder jwtDecoder(JwtUtil jwtUtil) { // 기존 JwtUtil.class에서 사용한 SecretKey 활용 return NimbusJwtDecoder.withSecretKey(jwtUtil.secretKey()) // 기존에 발행된 토큰을 파싱해보면 헤더에 {alg: HS384} 라고 명시됨 .macAlgorithm(MacAlgorithm.HS384).build(); } // Converter 등록 @Bean public JwtAuthenticationConverter jwtAuthenticationConverter() { JwtGrantedAuthoritiesConverter grantedAuthoritiesConverter = new JwtGrantedAuthoritiesConverter(); // 권한을 가져올 claim명 설정 grantedAuthoritiesConverter.setAuthoritiesClaimName(\"role\"); // 권한 앞에 Prefix 설정 grantedAuthoritiesConverter.setAuthorityPrefix(\"ROLE_\"); JwtAuthenticationConverter jwtAuthenticationConverter = new JwtAuthenticationConverter(); jwtAuthenticationConverter.setJwtGrantedAuthoritiesConverter(grantedAuthoritiesConverter); return jwtAuthenticationConverter; } } 이제 테스트를 실행해보면, 다음과 같이 모든 테스트가 성공합니다.\n커버리지 분석 결과, 다음과 같이 모든 코드를 테스트하고 있습니다.\n결론 이번 시간에는 oauth2-resource-server 라이브러리를 사용하여 JWT인증을 직접 구현해 보았습니다.\n해당 프로젝트의 전체 코드는 다음 깃허브 링크에서 확인하실 수 있습니다.\n해당 라이브러리에서도 내부적으로는 지난 시간에 구현한 JWT 인증 필터와 유사한 로직이 진행됩니다. 그러나 개인적으로는 필터를 직접 구현하는 것보다 많은 사용자들에게서 이미 검증된 라이브러리를 사용하는 것이 더욱 안전해 보이고, 예기치 못한 오류를 방지할 수 있을 것 같습니다.\n다음 포스팅 References URL 게시일자 방문일자 작성자 OAuth 2.0 Resource Server - 2024.12.17. Spring 해당 라이브러리의 내부적인 구조와 자세한 사용법은 다음 링크를 참고하시기 바랍니다. ↩︎\n","wordCount":"1146","inLanguage":"ko","image":"https://leaf-nam.github.io/posts/spring_security/6/coverage.png","datePublished":"2024-12-14T23:26:49+09:00","dateModified":"2024-12-14T23:26:49+09:00","author":{"@type":"Person","name":"Leaf"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://leaf-nam.github.io/posts/spring_security/6/"},"publisher":{"@type":"Organization","name":"봄을 기다리는 낙엽","logo":{"@type":"ImageObject","url":"https://leaf-nam.github.io/favicon.svg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://leaf-nam.github.io/ accesskey=h title="LEAF (Alt + H)">LEAF</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://leaf-nam.github.io/search/ title=검색><span>검색</span></a></li><li><a href=https://leaf-nam.github.io/posts/ title=게시글><span>게시글</span></a></li><li><a href=https://leaf-nam.github.io/tips/ title=미세팁><span>미세팁</span></a></li><li><a href=https://leaf-nam.github.io/archives/ title=아카이브><span>아카이브</span></a></li><li><a href=https://leaf-nam.github.io/cote/ title=알고리즘><span>알고리즘</span></a></li><li><a href=https://leaf-nam.github.io/review/ title="책 리뷰"><span>책 리뷰</span></a></li><li><a href=https://leaf-nam.github.io/categories/ title=카테고리><span>카테고리</span></a></li><li><a href=https://leaf-nam.github.io/tags/ title=태그><span>태그</span></a></li><li><a href=https://github.com/leaf-nam/blog title=Git><span>Git</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://leaf-nam.github.io/>홈</a>&nbsp;»&nbsp;<a href=https://leaf-nam.github.io/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://leaf-nam.github.io/posts/spring_security/>Spring Security 파헤치기</a></div><h1 class="post-title entry-hint-parent">[Java]Spring Security(With TDD) JWT 라이브러리 활용해서 간편하게 구현하기</h1><div class=post-description>JWT를 통한 인증을 oauth2-resource-server를 활용해서 간편하게 구현합니다.</div><div class=post-meta><span title='2024-12-14 23:26:49 +0900 KST'>2024. 12. 14.</span>&nbsp;·&nbsp;6 분&nbsp;·&nbsp;1146 단어&nbsp;·&nbsp;Leaf&nbsp;|&nbsp;<a href=https://github.com/leaf-nam/blog/blob/main/content//posts/spring_security/6/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>목차</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#도입>도입</a><ul><li><a href=#지난-포스팅>지난 포스팅</a></li></ul></li><li><a href=#설계>설계</a><ul><li><a href=#요구사항-분석>요구사항 분석</a></li><li><a href=#통합-테스트>통합 테스트</a></li></ul></li><li><a href=#구현>구현</a><ul><li><a href=#라이브러리-가져오기>라이브러리 가져오기</a></li><li><a href=#jwtsecurityconfigv2-구현>JwtSecurityConfigV2 구현</a></li><li><a href=#api-구현>API 구현</a></li><li><a href=#decoder-converter-구현>Decoder, Converter 구현</a></li></ul></li><li><a href=#결론>결론</a><ul><li><a href=#다음-포스팅>다음 포스팅</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></div></details></div><div class=post-content><h2 id=도입>도입<a hidden class=anchor aria-hidden=true href=#도입>#</a></h2><h3 id=지난-포스팅>지난 포스팅<a hidden class=anchor aria-hidden=true href=#지난-포스팅>#</a></h3><ul><li><a href=https://leaf-nam.github.io/posts/spring_security/1>[Java]Spring Security WebMVC 기본 구조</a></li><li><a href=https://leaf-nam.github.io/posts/spring_security/2>[Java]Spring Security 예외처리, 캐싱, 로깅</a></li><li><a href=https://leaf-nam.github.io/posts/spring_security/3>[Java]Spring Security 인증(Authentication)과 인가(Authorization)</a></li><li><a href=https://leaf-nam.github.io/posts/spring_security/4>[Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기</a></li><li><a href=https://leaf-nam.github.io/posts/spring_security/5>[Java]Spring Security(With TDD) JWT 직접 구현하기</a></li></ul><p>저번 시간에는 <code>JWT</code>의 <strong>인증 필터를 직접 구현</strong>해서 인증 로직을 완성했습니다.</p><p>이번 시간에는 <code>Spring</code>에서 제공하는 <code>oauth2-resource-server</code> 라이브러리를 통해 동일한 인증 로직을 구현해보겠습니다.</p><h2 id=설계>설계<a hidden class=anchor aria-hidden=true href=#설계>#</a></h2><h3 id=요구사항-분석>요구사항 분석<a hidden class=anchor aria-hidden=true href=#요구사항-분석>#</a></h3><p>요구 사항은 <a href=https://leaf-nam.github.io/posts/spring_security/5/#%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD-%EB%B6%84%EC%84%9D>지난 포스트</a>와 동일합니다.</p><ol><li>로그인 실패 시 jwt를 발행하지 않는다.</li><li>정상 로그인 시 jwt를 발행한다.<code>(Happy Case)</code></li><li>잘못된 jwt로 인증할 수 없다.</li><li>권한이 부족한 jwt에 인가할 수 없다.</li><li>정상적인 jwt로 특정 권한의 api를 사용할 수 있다.<code>(Happy Case)</code></li></ol><h3 id=통합-테스트>통합 테스트<a hidden class=anchor aria-hidden=true href=#통합-테스트>#</a></h3><p>통합 테스트도 <a href=https://leaf-nam.github.io/posts/spring_security/5/#%ED%86%B5%ED%95%A9%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%9E%91%EC%84%B1>지난 시간</a>에 사용한 것을 그대로 사용하겠습니다.</p><ul><li>다만, 기존 테스트와 <code>URL</code> 기반으로 요청을 분리하기 위해 다음과 같이 일부 테스트 코드를 변경하였습니다.</li></ul><ol><li>테스트에 사용할 <code>SecurityConfig</code>를 <code>JwtSecurityConfig</code>에서 <code>JwtSecurityConfigV2</code>로 변경합니다.</li><li>요청 <code>URL</code>을 <code>/jwt/**</code>에서 <code>/jwt/v2/**</code>로 변경합니다.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.springsecurity.jwt.integration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/* 생략 */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@ExtendWith</span><span class=p>(</span><span class=n>SpringExtension</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// SecurityConfig 변경</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@ContextConfiguration</span><span class=p>(</span><span class=n>classes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>JwtSecurityConfigV2</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@WebAppConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Import</span><span class=p>(</span><span class=n>IntegrationTestConfig</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JWTIntegrationV2Test</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MockMvc</span><span class=w> </span><span class=n>mockMvc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>JwtUtil</span><span class=w> </span><span class=n>jwtUtil</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>WebApplicationContext</span><span class=w> </span><span class=n>context</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@BeforeEach</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>init</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jwtUtil</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JwtUtil</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MockMvcBuilders</span><span class=p>.</span><span class=na>webAppContextSetup</span><span class=p>(</span><span class=n>context</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>apply</span><span class=p>(</span><span class=n>springSecurity</span><span class=p>()).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DisplayName</span><span class=p>(</span><span class=s>&#34;1. 로그인 실패 시 jwt를 발행하지 않는다.&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testLoginFailure</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// given : 유저와 관리자 아이디, 잘못된 패스워드</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user&#34;</span><span class=p>,</span><span class=w> </span><span class=n>adminId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;admin&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;badPassword&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// when : 사용자 토큰 발급 시도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>post</span><span class=p>(</span><span class=s>&#34;/jwt/v2/token&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>param</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>,</span><span class=w> </span><span class=n>userId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>param</span><span class=p>(</span><span class=s>&#34;password&#34;</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// then : 401(Unauthenticated) 오류</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>401</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// when : 관리자 토큰 발급 시도</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>post</span><span class=p>(</span><span class=s>&#34;/jwt/v2/token&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>param</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>,</span><span class=w> </span><span class=n>adminId</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>param</span><span class=p>(</span><span class=s>&#34;password&#34;</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// then : 401(Unauthenticated) 오류</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>401</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DisplayName</span><span class=p>(</span><span class=s>&#34;2. 정상 로그인 시 jwt를 발행한다.(Happy Case)&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testLoginSuccess</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// given : 유저와 관리자 아이디, 패스워드</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>userId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user&#34;</span><span class=p>,</span><span class=w> </span><span class=n>adminId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;admin&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>userPass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user1234&#34;</span><span class=p>,</span><span class=w> </span><span class=n>adminPass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;admin1234&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// when : 토큰 발급</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>userToken</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>post</span><span class=p>(</span><span class=s>&#34;/jwt/v2/token&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>param</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>,</span><span class=w> </span><span class=n>userId</span><span class=p>).</span><span class=na>param</span><span class=p>(</span><span class=s>&#34;password&#34;</span><span class=p>,</span><span class=w> </span><span class=n>userPass</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>200</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andReturn</span><span class=p>().</span><span class=na>getResponse</span><span class=p>().</span><span class=na>getContentAsString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>adminToken</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>post</span><span class=p>(</span><span class=s>&#34;/jwt/v2/token&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>param</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>,</span><span class=w> </span><span class=n>adminId</span><span class=p>).</span><span class=na>param</span><span class=p>(</span><span class=s>&#34;password&#34;</span><span class=p>,</span><span class=w> </span><span class=n>adminPass</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>200</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andReturn</span><span class=p>().</span><span class=na>getResponse</span><span class=p>().</span><span class=na>getContentAsString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// then : 정상 토큰여부 확인(JwtUtil)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jwtUtil</span><span class=p>.</span><span class=na>validate</span><span class=p>(</span><span class=n>userToken</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jwtUtil</span><span class=p>.</span><span class=na>validate</span><span class=p>(</span><span class=n>adminToken</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DisplayName</span><span class=p>(</span><span class=s>&#34;3. 잘못된 jwt로 인증할 수 없다.&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testAuthentication</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// given : 잘못된 jwt 토큰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>badToken</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;bearer asdf1234&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// when : User API 접근</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;/jwt/v2/user/resources&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>header</span><span class=p>(</span><span class=n>HttpHeaders</span><span class=p>.</span><span class=na>AUTHORIZATION</span><span class=p>,</span><span class=w> </span><span class=n>badToken</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// then : 401 오류</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>401</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DisplayName</span><span class=p>(</span><span class=s>&#34;4. 권한이 부족한 jwt에 인가할 수 없다.&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testAuthorization</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// given : USER 권한</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>role</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;ROLE_USER&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// when : Admin API 접근</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;/jwt/v2/admin/resources&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>with</span><span class=p>(</span><span class=n>jwt</span><span class=p>().</span><span class=na>authorities</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>SimpleGrantedAuthority</span><span class=p>(</span><span class=n>role</span><span class=p>))))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// then : 403(Forbidden) 오류</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>403</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DisplayName</span><span class=p>(</span><span class=s>&#34;5. 정상적인 jwt로 특정 권한의 api를 사용할 수 있다.`(Happy Case)`&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testHappyCase</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// given : ADMIN 권한</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>role</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;ROLE_ADMIN&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 권한 없이 PUBLIC API 접근</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;/jwt/v2/public/resources&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>200</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Admin 권한으로 USER API 접근</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;/jwt/v2/user/resources&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>with</span><span class=p>(</span><span class=n>jwt</span><span class=p>().</span><span class=na>authorities</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>SimpleGrantedAuthority</span><span class=p>(</span><span class=n>role</span><span class=p>))))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>200</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Admin 권한으로 Admin API 접근</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;/jwt/v2/admin/resources&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>with</span><span class=p>(</span><span class=n>jwt</span><span class=p>().</span><span class=na>authorities</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>SimpleGrantedAuthority</span><span class=p>(</span><span class=n>role</span><span class=p>))))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>200</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>위와 같이 <code>Spring Security</code> 설정을 변경 후, 컴파일 오류를 해결하기 위해 다음과 같이 임시로 <code>JwtSecurityConfigV2</code>를 생성합니다.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.springsecurity.jwt.config</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JwtSecurityConfigV2</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>이제 테스트를 실행하면 다음과 같이 모든 테스트가 실패합니다.</li></ul><p><img alt="통합테스트 실패" loading=lazy src=/posts/spring_security/6/integration_test_failure.png></p><ul><li>실패 메시지를 확인해보면, <code>springSecurityFilterChain cannot be null.</code> 이라는 메시지를 확인할 수 있습니다.</li><li><code>MockMVC</code>를 초기화하는 과정에서 <code>SpringSecurity</code>를 실행할 때 필수적인 <code>bean</code>인 <code>springSecurityFilterChain</code>이 <code>Spring</code>에 등록되어 있지 않기 때문입니다.</li></ul><blockquote><p>아직 해당 설정파일에 아무것도 작성하지 않았기 때문에 당연한 결과입니다.</p></blockquote><h2 id=구현>구현<a hidden class=anchor aria-hidden=true href=#구현>#</a></h2><h3 id=라이브러리-가져오기>라이브러리 가져오기<a hidden class=anchor aria-hidden=true href=#라이브러리-가져오기>#</a></h3><p>우선, <code>oauth2-resource-server</code><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>를 사용하기 위해 다음과 같이 <code>build.gradle</code>에 의존성을 주입합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=c1>// build.gradle
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>dependencies</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=s1>&#39;org.springframework.boot:spring-boot-starter-security&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>implementation</span> <span class=s1>&#39;org.springframework.boot:spring-boot-starter-web&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 의존성 추가
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>implementation</span> <span class=s1>&#39;org.springframework.boot:spring-boot-starter-oauth2-resource-server&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* 생략 */</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=jwtsecurityconfigv2-구현>JwtSecurityConfigV2 구현<a hidden class=anchor aria-hidden=true href=#jwtsecurityconfigv2-구현>#</a></h3><p>이후, 기존에 통합테스트를 실행하기 위해 클래스만 생성해 두었던 <code>JwtSecurityConfigV2</code>에 다음과 같이 설정합니다.</p><ul><li><code>SecurityMatcher URL</code> 설정 : <code>JwtSecurityConfig</code>와 <code>URL</code>기반으로 설정을 분리하기 위함입니다.</li><li><code>CSRF</code> 토큰 해제 : 해당 옵션을 해제하지 않고 <code>JWT</code> 로그인 시 <code>CSRF</code> 토큰이 없으면 오류가 발생할 수 있습니다. <code>JWT</code>는 <code>stateless</code>한 인증 방식이기 때문에 <strong><code>CSRF</code>토큰을
구현하기가 제한</strong>됩니다.</li><li><code>Session Management</code> 해제 : <code>JWT</code>는 <code>Session</code> 방식을 사용하지 않기 때문에 <strong>이를 해제해주어야 세션 정보를 서버에 별도로 저장하지 않습니다.</strong></li><li>권한별 인가 로직 작성 : <code>API</code>별 필요한 권한을 명시합니다.</li><li><code>CustomAuthenticationEntryPoint</code>
등록 : <a href=https://leaf-nam.github.io/posts/spring_security/4/#authenticationentrypoint-%EC%84%A4%EC%A0%95>저번에</a> 생성한 해당 클래스를
<code>ExceptionHandler</code>로 등록해야 인증 실패 시 <code>302</code>오류가 발생하지 않습니다.</li></ul><blockquote><p><a href=https://leaf-nam.github.io/posts/spring_security/5/#jwtsecurityconfig-%EA%B5%AC%ED%98%84>지난 시간</a>에 생성한 <code>JwtSecurityConfig</code>설정과
대부분 동일하지만, 요청 <code>URL</code>을 다르게 설정하기 때문에 두 필터가 모두 <code>SecurityFilterChain</code>에 등록되어 각각 적용됩니다.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.springsecurity.jwt.config</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Bean</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Configuration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.http.SessionCreationPolicy</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.web.SecurityFilterChain</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JwtSecurityConfigV2</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>SecurityFilterChain</span><span class=w> </span><span class=nf>jwtFilterChainV2</span><span class=p>(</span><span class=n>HttpSecurity</span><span class=w> </span><span class=n>http</span><span class=p>,</span><span class=w> </span><span class=n>CustomAuthenticationEntryPoint</span><span class=w> </span><span class=n>customAuthenticationEntryPoint</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>securityMatcher</span><span class=p>(</span><span class=s>&#34;/jwt/v2/**&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>csrf</span><span class=p>(</span><span class=n>AbstractHttpConfigurer</span><span class=p>::</span><span class=n>disable</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>sessionManagement</span><span class=p>(</span><span class=n>session</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>sessionCreationPolicy</span><span class=p>(</span><span class=n>SessionCreationPolicy</span><span class=p>.</span><span class=na>STATELESS</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>authorizeHttpRequests</span><span class=p>(</span><span class=n>authorize</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>authorize</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/jwt/v2/public/**&#34;</span><span class=p>).</span><span class=na>permitAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/jwt/v2/user/**&#34;</span><span class=p>).</span><span class=na>hasRole</span><span class=p>(</span><span class=s>&#34;USER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/jwt/v2/admin/**&#34;</span><span class=p>).</span><span class=na>hasRole</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/jwt/v2/token&#34;</span><span class=p>).</span><span class=na>permitAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>anyRequest</span><span class=p>().</span><span class=na>authenticated</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>exceptionHandling</span><span class=p>(</span><span class=n>handler</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>handler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>authenticationEntryPoint</span><span class=p>(</span><span class=n>customAuthenticationEntryPoint</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>이제 테스트를 수행하면 다음과 같이 3번 테스트만 성공합니다.</p><p><img alt=img.png loading=lazy src=/posts/spring_security/6/integration_test_failure_2.png></p><blockquote><p>해당 <code>API</code>의 <code>Controller</code>를 구현하지 않았기 때문에 <code>404</code>오류가 발생합니다.</p></blockquote><h3 id=api-구현>API 구현<a hidden class=anchor aria-hidden=true href=#api-구현>#</a></h3><p><a href=https://leaf-nam.github.io/posts/spring_security/5/#api-%EA%B5%AC%ED%98%84>지난 시간</a>과 마찬가지로, 다음과 같이 <code>JwtApiControllerV2</code>에 모든 <code>API</code>
를 생성하겠습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.springsecurity.jwt.api</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.springsecurity.jwt.Role</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.springsecurity.jwt.utility.JwtUtil</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.RequiredArgsConstructor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.HttpStatus</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.ResponseEntity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequiredArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/jwt/v2&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JwtApiControllerV2</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JwtUtil</span><span class=w> </span><span class=n>jwtUtil</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/admin/resources&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getAdminResources</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&#34;ADMIN 자원 획득&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/user/resources&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getUserResources</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&#34;USER 자원 획득&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/public/resources&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getPublicResources</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&#34;PUBLIC 자원 획득&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=p>(</span><span class=s>&#34;/token&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getToken</span><span class=p>(</span><span class=nd>@RequestParam</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=nd>@RequestParam</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>username</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=s>&#34;user&#34;</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>password</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=s>&#34;user1234&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>jwtUtil</span><span class=p>.</span><span class=na>issue</span><span class=p>(</span><span class=s>&#34;user&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Role</span><span class=p>.</span><span class=na>USER</span><span class=p>.</span><span class=na>name</span><span class=p>()),</span><span class=w> </span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>OK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>username</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=s>&#34;admin&#34;</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>password</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=s>&#34;admin1234&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>jwtUtil</span><span class=p>.</span><span class=na>issue</span><span class=p>(</span><span class=s>&#34;admin&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Role</span><span class=p>.</span><span class=na>ADMIN</span><span class=p>.</span><span class=na>name</span><span class=p>()),</span><span class=w> </span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>OK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>UNAUTHORIZED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>해당 <code>Controller</code>를 통합 테스트에 사용하기 위해 다음과 같이 <code>IntegrationTestConfig</code>를 수정합니다.</p><blockquote><p>해당 클래스는 <a href=https://leaf-nam.github.io/posts/spring_security/5/#jwtsecurityconfig-%EA%B5%AC%ED%98%84>이전 포스트</a>에서 통합 테스트 시 필요한 설정과 의존관계를 한번에 불러오기 위해 별도로 분리한 설정파일입니다.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.springsecurity.jwt.config</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/* 생략 */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//JwtApiControllerV2 추가</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Import</span><span class=p>({</span><span class=n>JwtApiControllerV2</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JwtApiController</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JwtUtil</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JwtAuthenticationFilter</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CustomAuthenticationEntryPoint</span><span class=p>.</span><span class=na>class</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>IntegrationTestConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;mvcHandlerMappingIntrospector&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>HandlerMappingIntrospector</span><span class=w> </span><span class=nf>mvcHandlerMappingIntrospector</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HandlerMappingIntrospector</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=p>(</span><span class=n>autowireCandidate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>RoleHierarchy</span><span class=w> </span><span class=nf>testRoleHierarchy</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>RoleHierarchyImpl</span><span class=p>.</span><span class=na>withDefaultRolePrefix</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>role</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>).</span><span class=na>implies</span><span class=p>(</span><span class=s>&#34;USER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>이제, 다음과 같이 jwt 발행 관련 로직이 모두 성공합니다.</p><p><img alt=img.png loading=lazy src=/posts/spring_security/6/integration_test_success.png></p><blockquote><p>나머지 테스트에서는 아직 <code>JWT</code>를 활용한 인증 로직이 적용되지 않았기 때문에 401 오류가 발생합니다.</p></blockquote><h3 id=decoder-converter-구현>Decoder, Converter 구현<a hidden class=anchor aria-hidden=true href=#decoder-converter-구현>#</a></h3><p>토큰 인증을 도입하기 위해서는 <code>Decoder</code>와 <code>Converter</code>가 필요합니다.</p><ul><li><code>Decoder</code> : <code>Authorization</code> 헤더에 있는 <code>Bearer + 'accessToken'</code>형태의 토큰을 복호화하여 유효성 검증과 함께 내부의 권한을 체크합니다.</li><li><code>Converter</code> : 복호화된 토큰에서 권한을 찾아서 <code>grantedAuthorities</code>에 등록합니다.</li></ul><p>다음과 같이 <code>JwtSecurityConfigV2</code> 내부에 이를 구현하겠습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.springsecurity.jwt.config</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/* 생략 */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JwtSecurityConfigV2</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>SecurityFilterChain</span><span class=w> </span><span class=nf>jwtFilterChainV2</span><span class=p>(</span><span class=n>HttpSecurity</span><span class=w> </span><span class=n>http</span><span class=p>,</span><span class=w> </span><span class=n>CustomAuthenticationEntryPoint</span><span class=w> </span><span class=n>customAuthenticationEntryPoint</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>securityMatcher</span><span class=p>(</span><span class=s>&#34;/jwt/v2/**&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>csrf</span><span class=p>(</span><span class=n>AbstractHttpConfigurer</span><span class=p>::</span><span class=n>disable</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>sessionManagement</span><span class=p>(</span><span class=n>session</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>sessionCreationPolicy</span><span class=p>(</span><span class=n>SessionCreationPolicy</span><span class=p>.</span><span class=na>STATELESS</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// OAuth2ResourceServer 사용하도록 FilterChain 등록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>oauth2ResourceServer</span><span class=p>(</span><span class=n>oauth2</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>oauth2</span><span class=p>.</span><span class=na>jwt</span><span class=p>(</span><span class=n>Customizer</span><span class=p>.</span><span class=na>withDefaults</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>authorizeHttpRequests</span><span class=p>(</span><span class=n>authorize</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>authorize</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/jwt/v2/public/**&#34;</span><span class=p>).</span><span class=na>permitAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/jwt/v2/user/**&#34;</span><span class=p>).</span><span class=na>hasRole</span><span class=p>(</span><span class=s>&#34;USER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/jwt/v2/admin/**&#34;</span><span class=p>).</span><span class=na>hasRole</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/jwt/v2/token&#34;</span><span class=p>).</span><span class=na>permitAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>anyRequest</span><span class=p>().</span><span class=na>authenticated</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>exceptionHandling</span><span class=p>(</span><span class=n>handler</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>handler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>authenticationEntryPoint</span><span class=p>(</span><span class=n>customAuthenticationEntryPoint</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Decoder 등록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>JwtDecoder</span><span class=w> </span><span class=nf>jwtDecoder</span><span class=p>(</span><span class=n>JwtUtil</span><span class=w> </span><span class=n>jwtUtil</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 기존 JwtUtil.class에서 사용한 SecretKey 활용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>NimbusJwtDecoder</span><span class=p>.</span><span class=na>withSecretKey</span><span class=p>(</span><span class=n>jwtUtil</span><span class=p>.</span><span class=na>secretKey</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 기존에 발행된 토큰을 파싱해보면 헤더에 {alg: HS384} 라고 명시됨</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>macAlgorithm</span><span class=p>(</span><span class=n>MacAlgorithm</span><span class=p>.</span><span class=na>HS384</span><span class=p>).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Converter 등록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>JwtAuthenticationConverter</span><span class=w> </span><span class=nf>jwtAuthenticationConverter</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JwtGrantedAuthoritiesConverter</span><span class=w> </span><span class=n>grantedAuthoritiesConverter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JwtGrantedAuthoritiesConverter</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 권한을 가져올 claim명 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>grantedAuthoritiesConverter</span><span class=p>.</span><span class=na>setAuthoritiesClaimName</span><span class=p>(</span><span class=s>&#34;role&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 권한 앞에 Prefix 설정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>grantedAuthoritiesConverter</span><span class=p>.</span><span class=na>setAuthorityPrefix</span><span class=p>(</span><span class=s>&#34;ROLE_&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JwtAuthenticationConverter</span><span class=w> </span><span class=n>jwtAuthenticationConverter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JwtAuthenticationConverter</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jwtAuthenticationConverter</span><span class=p>.</span><span class=na>setJwtGrantedAuthoritiesConverter</span><span class=p>(</span><span class=n>grantedAuthoritiesConverter</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>jwtAuthenticationConverter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>이제 테스트를 실행해보면, 다음과 같이 모든 테스트가 성공합니다.</p><p><img alt="통합테스트 성공 2" loading=lazy src=/posts/spring_security/6/integration_test_success_2.png></p><p>커버리지 분석 결과, 다음과 같이 모든 코드를 테스트하고 있습니다.</p><p><img alt="테스트 커버리지" loading=lazy src=/posts/spring_security/6/coverage.png></p><h2 id=결론>결론<a hidden class=anchor aria-hidden=true href=#결론>#</a></h2><p>이번 시간에는 <code>oauth2-resource-server</code> 라이브러리를 사용하여 <code>JWT</code>인증을 직접 구현해 보았습니다.</p><blockquote><p>해당 프로젝트의 전체 코드는 <a href=https://github.com/leaf-nam/spring_security_example><strong>다음 깃허브 링크</strong></a>에서 확인하실 수 있습니다.</p></blockquote><ul><li>해당 라이브러리에서도 내부적으로는 <a href=https://leaf-nam.github.io/posts/spring_security/5>지난 시간</a>에 구현한 <code>JWT 인증 필터</code>와 유사한 로직이 진행됩니다.</li></ul><blockquote><p>그러나 개인적으로는 필터를 직접 구현하는 것보다 <strong>많은 사용자들에게서 이미 검증된 라이브러리를 사용</strong>하는 것이 더욱 안전해 보이고, 예기치 못한 오류를 방지할 수 있을 것 같습니다.</p></blockquote><h3 id=다음-포스팅>다음 포스팅<a hidden class=anchor aria-hidden=true href=#다음-포스팅>#</a></h3><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><table><thead><tr><th style=text-align:left>URL</th><th style=text-align:left>게시일자</th><th style=text-align:left>방문일자</th><th style=text-align:left>작성자</th></tr></thead><tbody><tr><td style=text-align:left><a href=https://docs.spring.io/spring-security/reference/servlet/oauth2/resource-server/>OAuth 2.0 Resource Server</a></td><td style=text-align:left>-</td><td style=text-align:left>2024.12.17.</td><td style=text-align:left>Spring</td></tr></tbody></table><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>해당 라이브러리의 내부적인 구조와 자세한 사용법은 <a href=https://docs.spring.io/spring-security/reference/servlet/oauth2/resource-server/>다음 링크</a>를 참고하시기 바랍니다.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://leaf-nam.github.io/tags/authentication/>Authentication</a></li><li><a href=https://leaf-nam.github.io/tags/jwt/>Jwt</a></li></ul><nav class=paginav><a class=prev href=https://leaf-nam.github.io/cote/bj_1005/><span class=title>« 이전 페이지</span><br><span>[Java]백준 1005 ACM Craft</span>
</a><a class=next href=https://leaf-nam.github.io/cote/bj_9202/><span class=title>다음 페이지 »</span><br><span>[Java]백준 9202 Boggle</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share [Java]Spring Security(With TDD) JWT 라이브러리 활용해서 간편하게 구현하기 on x" href="https://x.com/intent/tweet/?text=%5bJava%5dSpring%20Security%28With%20TDD%29%20JWT%20%eb%9d%bc%ec%9d%b4%eb%b8%8c%eb%9f%ac%eb%a6%ac%20%ed%99%9c%ec%9a%a9%ed%95%b4%ec%84%9c%20%ea%b0%84%ed%8e%b8%ed%95%98%ea%b2%8c%20%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0&amp;url=https%3a%2f%2fleaf-nam.github.io%2fposts%2fspring_security%2f6%2f&amp;hashtags=authentication%2cjwt"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Java]Spring Security(With TDD) JWT 라이브러리 활용해서 간편하게 구현하기 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fleaf-nam.github.io%2fposts%2fspring_security%2f6%2f&amp;title=%5bJava%5dSpring%20Security%28With%20TDD%29%20JWT%20%eb%9d%bc%ec%9d%b4%eb%b8%8c%eb%9f%ac%eb%a6%ac%20%ed%99%9c%ec%9a%a9%ed%95%b4%ec%84%9c%20%ea%b0%84%ed%8e%b8%ed%95%98%ea%b2%8c%20%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0&amp;summary=%5bJava%5dSpring%20Security%28With%20TDD%29%20JWT%20%eb%9d%bc%ec%9d%b4%eb%b8%8c%eb%9f%ac%eb%a6%ac%20%ed%99%9c%ec%9a%a9%ed%95%b4%ec%84%9c%20%ea%b0%84%ed%8e%b8%ed%95%98%ea%b2%8c%20%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0&amp;source=https%3a%2f%2fleaf-nam.github.io%2fposts%2fspring_security%2f6%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Java]Spring Security(With TDD) JWT 라이브러리 활용해서 간편하게 구현하기 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fleaf-nam.github.io%2fposts%2fspring_security%2f6%2f&title=%5bJava%5dSpring%20Security%28With%20TDD%29%20JWT%20%eb%9d%bc%ec%9d%b4%eb%b8%8c%eb%9f%ac%eb%a6%ac%20%ed%99%9c%ec%9a%a9%ed%95%b4%ec%84%9c%20%ea%b0%84%ed%8e%b8%ed%95%98%ea%b2%8c%20%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Java]Spring Security(With TDD) JWT 라이브러리 활용해서 간편하게 구현하기 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fleaf-nam.github.io%2fposts%2fspring_security%2f6%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Java]Spring Security(With TDD) JWT 라이브러리 활용해서 간편하게 구현하기 on whatsapp" href="https://api.whatsapp.com/send?text=%5bJava%5dSpring%20Security%28With%20TDD%29%20JWT%20%eb%9d%bc%ec%9d%b4%eb%b8%8c%eb%9f%ac%eb%a6%ac%20%ed%99%9c%ec%9a%a9%ed%95%b4%ec%84%9c%20%ea%b0%84%ed%8e%b8%ed%95%98%ea%b2%8c%20%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0%20-%20https%3a%2f%2fleaf-nam.github.io%2fposts%2fspring_security%2f6%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Java]Spring Security(With TDD) JWT 라이브러리 활용해서 간편하게 구현하기 on telegram" href="https://telegram.me/share/url?text=%5bJava%5dSpring%20Security%28With%20TDD%29%20JWT%20%eb%9d%bc%ec%9d%b4%eb%b8%8c%eb%9f%ac%eb%a6%ac%20%ed%99%9c%ec%9a%a9%ed%95%b4%ec%84%9c%20%ea%b0%84%ed%8e%b8%ed%95%98%ea%b2%8c%20%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0&amp;url=https%3a%2f%2fleaf-nam.github.io%2fposts%2fspring_security%2f6%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Java]Spring Security(With TDD) JWT 라이브러리 활용해서 간편하게 구현하기 on ycombinator" href="https://news.ycombinator.com/submitlink?t=%5bJava%5dSpring%20Security%28With%20TDD%29%20JWT%20%eb%9d%bc%ec%9d%b4%eb%b8%8c%eb%9f%ac%eb%a6%ac%20%ed%99%9c%ec%9a%a9%ed%95%b4%ec%84%9c%20%ea%b0%84%ed%8e%b8%ed%95%98%ea%b2%8c%20%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0&u=https%3a%2f%2fleaf-nam.github.io%2fposts%2fspring_security%2f6%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://utteranc.es/client.js repo=leaf-nam/leaf-nam.github.io issue-term=title theme=boxy-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://leaf-nam.github.io/>봄을 기다리는 낙엽</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="복사";function s(){t.innerHTML="복사 완료!",setTimeout(()=>{t.innerHTML="복사"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>