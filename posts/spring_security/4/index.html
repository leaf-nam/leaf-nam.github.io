<!doctype html><html lang=ko dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기 | 봄을 기다리는 낙엽</title>
<meta name=keywords content="authentication,jwt"><meta name=description content="TDD로 Spring Security의 기본 인증 및 인가를 구현합니다."><meta name=author content="Leaf"><link rel=canonical href=https://1eaf.site/posts/spring_security/4/><meta name=google-site-verification content="l76eAEMadEn1QzS8fLTbrl8ppayZprvV3uuAbMGSy_c"><meta name=msvalidate.01 content="XYZabc"><meta name=naver-site-verification content="adff811404d441495a954e30579f40297ba14f5e"><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=https://1eaf.site/icon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://1eaf.site/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://1eaf.site/favicon-32x32.png><link rel=apple-touch-icon href=https://1eaf.site/icon/apple-touch-icon.png><link rel=mask-icon href=https://1eaf.site/icon/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ko href=https://1eaf.site/posts/spring_security/4/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-9PNFP00SSG"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9PNFP00SSG")}</script><meta property="og:url" content="https://1eaf.site/posts/spring_security/4/"><meta property="og:site_name" content="봄을 기다리는 낙엽"><meta property="og:title" content="[Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기"><meta property="og:description" content="TDD로 Spring Security의 기본 인증 및 인가를 구현합니다."><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-05T19:58:51+09:00"><meta property="article:modified_time" content="2024-12-05T19:58:51+09:00"><meta property="article:tag" content="Authentication"><meta property="article:tag" content="Jwt"><meta name=twitter:card content="summary"><meta name=twitter:title content="[Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기"><meta name=twitter:description content="TDD로 Spring Security의 기본 인증 및 인가를 구현합니다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://1eaf.site/posts/"},{"@type":"ListItem","position":2,"name":"Spring Security 파헤치기","item":"https://1eaf.site/posts/spring_security/"},{"@type":"ListItem","position":3,"name":"[Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기","item":"https://1eaf.site/posts/spring_security/4/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기","name":"[Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기","description":"TDD로 Spring Security의 기본 인증 및 인가를 구현합니다.","keywords":["authentication","jwt"],"articleBody":"도입 지난 포스팅 [Java]Spring Security WebMVC 기본 구조 [Java]Spring Security 예외처리, 캐싱, 로깅 [Java]Spring Security 인증(Authentication)과 인가(Authorization) 지금까지 Spring Security의 핵심 개념에 대해 알아보았습니다. 이번 시간에는 TDD1로 실제 프로젝트를 생성하고 인증 및 인가 로직을 구현해보겠습니다.\n프로젝트 생성 1. Springboot Project Setup Spring 프로젝트 생성 페이지에서 다음과 같이 세팅 및 4개의 의존성을 추가해줍니다. 2. 디렉터리 구조 생성 패키지는 다음과 같이 생성하겠습니다. api 클라이언트와의 통신 인터페이스입니다. 컨트롤러 클래스를 포함시킬 예정입니다. config Spring Security를 포함한 각종 설정 클래스를 포함시킬 예정입니다. 3. 기본 로그인 페이지 생성 Spring Security 의존성을 추가 후 JwtApplication.class의 Main 메서드를 실행한 뒤, 브라우저를 통해 http://localhost:8080에 접속하면 다음과 같이 기본적으로 로그인 페이지를 제공합니다. 하지만, 위 로그인 페이지의 패스워드는 마치 OTT2처럼, 매번 SpringBoot 서버가 실행될 때마다 패스워드가 변경됩니다.\n계정별 기본 패스워드를 설정하기 위해 예제 페이지를 참고해서 다음과 같이 config 패키지 내부에 SecurityConfig 클래스를 생성합니다.\npackage com.springsecurity.jwt.config; /* import 생략 */ @Configuration @EnableWebSecurity public class SecurityConfig { @Bean public UserDetailsService userDetailsService() { List\u003cUserDetails\u003e userDetails = List.of( User.withDefaultPasswordEncoder().username(\"user\").password(\"user1234\").roles(\"USER\").build(), User.withDefaultPasswordEncoder().username(\"admin\").password(\"admin1234\").roles(\"ADMIN\").build()); return new InMemoryUserDetailsManager(userDetails); } @Bean public PasswordEncoder passwordEncoder() { return PasswordEncoderFactories.createDelegatingPasswordEncoder(); } } 위와 같이 설정하면 User 계정과 Admin 계정을 통한 로그인이 가능해집니다.\nwithDefaultPasswordEncoder()메서드는 예제용이기 때문에 실제 프로젝트의 인증 로직에서 활용하면 취약할 수 있습니다.\n4. 기본 API 생성 다음과 같이 세 가지 API가 있다고 가정하겠습니다.\n누구나 접근 가능한 API USER 권한 이상의 사용자만 접근 가능한 API ADMIN 권한의 사용자만 접근 가능한 API 이러한 자원을 다음과 같이 api 패키지 내부의 ApiController로 구현하겠습니다.\npackage com.springsecurity.jwt.api; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class ApiController { @GetMapping(\"/admin/resources\") public String getAdminResources() { return \"ADMIN 자원 획득\"; } @GetMapping(\"/user/resources\") public String getUserResources() { return \"USER 자원 획득\"; } @GetMapping(\"/public/resources\") public String getPublicResources() { return \"PUBLIC 자원 획득\"; } } 여기까지는 프로젝트 구조를 빠르게 잡기 위해 테스트코드를 작성하지 않았습니다. 이후부터는 TDD 스타일로 테스트를 우선 작성하고, 실제 구현을 이어나가겠습니다.\n설계 요구사항 분석 인증 및 인가를 사용해서 달성하려는 요구사항은 다음과 같이 3가지로 분석할 수 있습니다.\n실제로는 훨씬 많은 요구사항이 있을 수 있지만, 예제이므로 최소한의 기능만을 테스트하겠습니다.\n권한이 없는 사용자가 인증이 필요한 요청 시 401 응답(인증 오류) 권한이 부족한 사용자가 상위 권한의 요청 시 403 응답(인가 오류) 적절한 권한이 있는 사용자는 인증이 필요한 요청 시 200 응답(Happy Case) TDD를 할때는 작성하기 쉬운 Happy Case보다 예외상황과 경계값 등 놓치기 쉬운 테스트케이스를 먼저 작성하는게 좋습니다.\n통합테스트 작성 다음 페이지를 참고해서 위 요구사항에 맞는 통합테스트를 작성해보겠습니다.\n보통 TDD는 단위테스트로 구현되지만, 외부 의존성인 Spring Security의 로직을 테스트하기 위해서는 Mocking3이 필수적입니다.\npackage com.springsecurity.jwt.config; import com.springsecurity.jwt.api.ApiController; import org.junit.jupiter.api.BeforeEach; import org.junit.jupiter.api.DisplayName; import org.junit.jupiter.api.Test; import org.junit.jupiter.api.extension.ExtendWith; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Import; import org.springframework.test.context.ContextConfiguration; import org.springframework.test.context.junit.jupiter.SpringExtension; import org.springframework.test.context.web.WebAppConfiguration; import org.springframework.test.web.servlet.MockMvc; import org.springframework.test.web.servlet.setup.MockMvcBuilders; import org.springframework.web.context.WebApplicationContext; import static org.springframework.security.test.web.servlet.request.SecurityMockMvcRequestPostProcessors.user; import static org.springframework.security.test.web.servlet.setup.SecurityMockMvcConfigurers.springSecurity; import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get; import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status; @ExtendWith(SpringExtension.class) @ContextConfiguration(classes = SecurityConfig.class) @WebAppConfiguration @Import(ApiController.class) class AuthenticationTest { MockMvc mockMvc; @Autowired WebApplicationContext context; @BeforeEach void init() { mockMvc = MockMvcBuilders.webAppContextSetup(context) .apply(springSecurity()).build(); } @Test @DisplayName(\"권한이 없는 사용자가 인증이 필요한 요청 시 401 응답(인증 오류)\") void testAuthenticationError() throws Exception { mockMvc.perform(get(\"/user/resources\")) .andExpect(status().is(401)); } @Test @DisplayName(\" 권한이 부족한 사용자가 상위 권한의 요청 시 403 응답(인가 오류)\") void testAuthorizationError() throws Exception { mockMvc.perform(get(\"/admin/resources\").with(user(\"user\").roles(\"USER\"))) .andExpect(status().is(403)); } @Test @DisplayName(\"적절한 권한이 있는 사용자는 인증이 필요한 요청 시 200 응답(Happy Case)\") void testHappyCase() throws Exception { // 권한 없는 사용자 -\u003e Public API mockMvc.perform(get(\"/public/resources\")) .andExpect(status().is(200)); // User -\u003e User API mockMvc.perform(get(\"/user/resources\").with(user(\"user\").roles(\"USER\"))) .andExpect(status().is(200)); // Admin -\u003e User API mockMvc.perform(get(\"/user/resources\").with(user(\"admin\").roles(\"ADMIN\"))) .andExpect(status().is(200)); // Admin -\u003e Admin API mockMvc.perform(get(\"/admin/resources\").with(user(\"admin\").roles(\"ADMIN\"))) .andExpect(status().is(200)); } } 위와 같이 mockMvc의 perform()메서드로 API 요청을 Mocking할 때, with()메서드의 파라미터로 SecurityMockMvcRequestPostProcessors.user()메서드를 사용하면 임시 사용자를 만들어 권한을 설정할 수 있습니다.\n구현 위에서 작성한 테스트를 실행해보면 인증 테스트는 통과하지만, 인가 테스트와 Happy Case가 실패합니다.\n현재 인증 관련 로직을 작성하지는 않았지만, Spring Security 의존성을 추가하면 자동으로 인증 관련 로직이 추가되기 때문에 모든 요청에서 401오류가 발생하여 첫번째 테스트가 통과합니다.\nAPI별 권한 부여 먼저, API별로 필요한 권한을 설정하기 위해 다음과 같이 SecurityConfig를 수정합니다.\n/* 생략 */ @Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { return http .authorizeHttpRequests(authorize -\u003e authorize // Public API는 모든 요청에 허용 .requestMatchers(\"/public/**\").permitAll() // User API는 USER 권한 필요 .requestMatchers(\"/user/**\").hasRole(\"USER\") // Admin API는 ADMIN 권한 필요 .requestMatchers(\"/admin/**\").hasRole(\"ADMIN\")) .formLogin(Customizer.withDefaults()) .build(); } // MockMVC에서 HandlerMappingIntrospector를 사용하기 위함 @Bean(name = \"mvcHandlerMappingIntrospector\") public HandlerMappingIntrospector mvcHandlerMappingIntrospector() { return new HandlerMappingIntrospector(); } /* 생략 */ mvcHandlerMappingIntrospector를 Bean으로 등록한 이유는 MockMvc가 실행될 때 해당 Bean이 없으면 requestMatcher를 정상적으로 실행하지 못하기 때문입니다.4\n다시 테스트를 실행해보면, 다음과 같이 2번째(인가) 테스트 케이스만 성공하는 것을 확인할 수 있습니다. 1번(인증) 테스트가 실패하는 원인은 SecurityFilterChain에 필요한 권한이 설정되었지만, Spring Security의 기본 정책 상 권한이 부족할 경우 로그인 페이지로 이동하는 302를 응답하기 때문입니다. 3번(Happy Case) 테스트가 실패하는 원인은 ADMIN 역할이 USER 역할을 갖고 있지 않기 때문에 User API에 접근할 권한이 없기 때문에 403을 응답하기 때문입니다. AuthenticationEntryPoint 설정 1번(인증) 테스트를 성공하기 위해 권한이 부족할 경우 401 응답을 보내도록 AuthenticationEntryPoint를 수정하겠습니다.5\n@Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { return http .authorizeHttpRequests(authorize -\u003e authorize .requestMatchers(\"/public/**\").permitAll() .requestMatchers(\"/user/**\").hasRole(\"USER\") .requestMatchers(\"/admin/**\").hasRole(\"ADMIN\")) .formLogin(Customizer.withDefaults()) .exceptionHandling(handler -\u003e handler .authenticationEntryPoint(new CustomAuthenticationEntryPoint())) .build(); } static class CustomAuthenticationEntryPoint implements AuthenticationEntryPoint { @Override public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException { response.setCharacterEncoding(\"UTF-8\"); response.sendError(401, \"인증 오류\"); } } 다시 테스트를 실행해보면, 다음과 같이 1, 2번째(인가) 테스트 케이스가 성공하는 것을 확인할 수 있습니다. RoleHierarchy 설정 마지막(Happy Case) 테스트를 성공하기 위해 다음과 같이 RoleHierarchy(계층적 권한)을 Bean으로 등록하겠습니다.6\n@Bean static RoleHierarchy roleHierarchy() { return RoleHierarchyImpl.withDefaultRolePrefix() .role(\"ADMIN\").implies(\"USER\") .build(); } 다시 테스트를 실행해보면, 드디어 모든 테스트가 성공합니다! 결론 지금까지 예제 프로젝트를 생성 후, 인증과 인가 요구사항을 통합테스트로 작성하고 모든 요구사항을 달성했습니다.\n해당 프로젝트의 전체 코드는 다음 깃허브 링크에서 확인하실 수 있습니다. 다음 포스팅에서는 현재 프로젝트에 JWT를 활용한 인증 및 인가를 도입해보겠습니다.\n다음 포스팅 [Java]Spring Security(With TDD) JWT 구현하기 References URL 게시일자 방문일자 작성자 Spring 공식문서 - 2024.12.06. Spring RFC 7519 2015.05. 2024.12.06. IETF 모의 객체 2024.05.16. 2024.12.07. Wikipedia Spring 이슈 20848 2017.12.14. 2024.12.07. spring-projects-issues Test Driven Development의 준말로, 단위 테스트를 먼저 작성한 후 구현하는 방식의 개발 방법론입니다. ↩︎\nOne Time Token의 준말로, 1회성 토큰을 뜻합니다. 웹에서 회원가입을 할 때, 이메일이나 문자로 받는 토큰이 여기에 해당합니다. ↩︎\n모의 객체를 생성하여 테스트하는 것을 말합니다.\n실제 모듈을 사용하는 테스트는 변경에 취약하고 깨지기 쉬울 뿐 아니라 내부 로직을 잘 이해하지 못하면 작성이 어렵기 때문에, 외부 의존성에는 Mocking을 활용하여 효율적으로 테스트할 수 있습니다.\n↩︎ 관련 내용은 다음 이슈를 참고하시기 바랍니다.\n원래 테스트를 성공시키기 위해 설정 코드를 추가하는 것은 바람직하지 않으나, 아직은 프로젝트 규모가 크지 않고 테스트에 집중하기 위해 별도의 테스트 설정 파일을 생성하지는 않았습니다.\n↩︎ AuthenticationEntryPoint에 대한 자세한 설명은 인증 오류 관련 이전 포스팅을 참고바랍니다. ↩︎\nRoleHierarchy에 대한 자세한 설명은 인가 관련 이전 포스팅을 참고바랍니다. ↩︎\n","wordCount":"1018","inLanguage":"ko","datePublished":"2024-12-05T19:58:51+09:00","dateModified":"2024-12-05T19:58:51+09:00","author":{"@type":"Person","name":"Leaf"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://1eaf.site/posts/spring_security/4/"},"publisher":{"@type":"Organization","name":"봄을 기다리는 낙엽","logo":{"@type":"ImageObject","url":"https://1eaf.site/icon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://1eaf.site/ accesskey=h title="LEAF (Alt + H)">LEAF</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://1eaf.site/concept/ title=개념정리><span>개념정리</span></a></li><li><a href=https://1eaf.site/search/ title=검색><span>검색</span></a></li><li><a href=https://1eaf.site/posts/ title=게시글><span>게시글</span></a></li><li><a href=https://1eaf.site/tips/ title=미세팁><span>미세팁</span></a></li><li><a href=https://1eaf.site/archives/ title=아카이브><span>아카이브</span></a></li><li><a href=https://1eaf.site/cote/ title=알고리즘><span>알고리즘</span></a></li><li><a href=https://1eaf.site/review/ title="책 리뷰"><span>책 리뷰</span></a></li><li><a href=https://1eaf.site/categories/ title=카테고리><span>카테고리</span></a></li><li><a href=https://1eaf.site/tags/ title=태그><span>태그</span></a></li><li><a href=https://github.com/leaf-nam/blog title=Git><span>Git</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://1eaf.site/>홈</a>&nbsp;»&nbsp;<a href=https://1eaf.site/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://1eaf.site/posts/spring_security/>Spring Security 파헤치기</a></div><h1 class="post-title entry-hint-parent">[Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기</h1><div class=post-description>TDD로 Spring Security의 기본 인증 및 인가를 구현합니다.</div><div class=post-meta><span title='2024-12-05 19:58:51 +0900 KST'>2024. 12. 5.</span>&nbsp;·&nbsp;5 분&nbsp;·&nbsp;1018 단어&nbsp;·&nbsp;Leaf&nbsp;|&nbsp;<a href=https://github.com/leaf-nam/blog/blob/main/content//posts/spring_security/4/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>목차</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#도입>도입</a><ul><li><a href=#지난-포스팅>지난 포스팅</a></li></ul></li><li><a href=#프로젝트-생성>프로젝트 생성</a><ul><li><a href=#1-springboot-project-setup>1. <strong>Springboot Project Setup</strong></a></li><li><a href=#2-디렉터리-구조-생성>2. <strong>디렉터리 구조 생성</strong></a></li><li><a href=#3-기본-로그인-페이지-생성>3. <strong>기본 로그인 페이지 생성</strong></a></li><li><a href=#4-기본-api-생성>4. <strong>기본 API 생성</strong></a></li></ul></li><li><a href=#설계>설계</a><ul><li><a href=#요구사항-분석>요구사항 분석</a></li><li><a href=#통합테스트-작성>통합테스트 작성</a></li></ul></li><li><a href=#구현>구현</a><ul><li><a href=#api별-권한-부여>API별 권한 부여</a></li><li><a href=#authenticationentrypoint-설정>AuthenticationEntryPoint 설정</a></li><li><a href=#rolehierarchy-설정>RoleHierarchy 설정</a></li></ul></li><li><a href=#결론>결론</a><ul><li><a href=#다음-포스팅>다음 포스팅</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></div></details></div><div class=post-content><h2 id=도입>도입<a hidden class=anchor aria-hidden=true href=#도입>#</a></h2><h3 id=지난-포스팅>지난 포스팅<a hidden class=anchor aria-hidden=true href=#지난-포스팅>#</a></h3><ul><li><a href=https://1eaf.site/posts/spring_security/1>[Java]Spring Security WebMVC 기본 구조</a></li><li><a href=https://1eaf.site/posts/spring_security/2>[Java]Spring Security 예외처리, 캐싱, 로깅</a></li><li><a href=https://1eaf.site/posts/spring_security/3>[Java]Spring Security 인증(Authentication)과 인가(Authorization)</a></li></ul><p>지금까지 Spring Security의 핵심 개념에 대해 알아보았습니다.
이번 시간에는 TDD<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>로 실제 프로젝트를 생성하고 인증 및 인가 로직을 구현해보겠습니다.</p><h2 id=프로젝트-생성>프로젝트 생성<a hidden class=anchor aria-hidden=true href=#프로젝트-생성>#</a></h2><h3 id=1-springboot-project-setup>1. <strong>Springboot Project Setup</strong><a hidden class=anchor aria-hidden=true href=#1-springboot-project-setup>#</a></h3><ul><li><a href=https://start.spring.io/>Spring 프로젝트 생성 페이지</a>에서 다음과 같이 세팅 및 4개의 의존성을 추가해줍니다.
<img alt="start spring" loading=lazy src=/posts/spring_security/4/spring_init.png></li></ul><h3 id=2-디렉터리-구조-생성>2. <strong>디렉터리 구조 생성</strong><a hidden class=anchor aria-hidden=true href=#2-디렉터리-구조-생성>#</a></h3><ul><li>패키지는 다음과 같이 생성하겠습니다.
<img alt="디렉터리 구조" loading=lazy src=/posts/spring_security/4/directory.png></li><li><strong>api</strong><ul><li>클라이언트와의 통신 인터페이스입니다.</li><li>컨트롤러 클래스를 포함시킬 예정입니다.</li></ul></li><li><strong>config</strong><ul><li>Spring Security를 포함한 각종 설정 클래스를 포함시킬 예정입니다.</li></ul></li></ul><h3 id=3-기본-로그인-페이지-생성>3. <strong>기본 로그인 페이지 생성</strong><a hidden class=anchor aria-hidden=true href=#3-기본-로그인-페이지-생성>#</a></h3><ul><li><p>Spring Security 의존성을 추가 후 <code>JwtApplication.class</code>의 Main 메서드를 실행한 뒤, 브라우저를 통해 http://localhost:8080에 접속하면 다음과 같이 기본적으로 로그인 페이지를 제공합니다.
<img alt="로그인 페이지" loading=lazy src=/posts/spring_security/4/login.png></p></li><li><p>하지만, 위 로그인 페이지의 패스워드는 마치 <code>OTT</code><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>처럼, 매번 SpringBoot 서버가 실행될 때마다 패스워드가 변경됩니다.</p></li><li><p>계정별 기본 패스워드를 설정하기 위해 <a href=https://docs.spring.io/spring-security/reference/servlet/getting-started.html>예제 페이지</a>를 참고해서 다음과 같이 <code>config</code> 패키지 내부에 <code>SecurityConfig</code> 클래스를 생성합니다.</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.springsecurity.jwt.config</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/* import 생략 */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SecurityConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>UserDetailsService</span><span class=w> </span><span class=nf>userDetailsService</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>UserDetails</span><span class=o>&gt;</span><span class=w> </span><span class=n>userDetails</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>User</span><span class=p>.</span><span class=na>withDefaultPasswordEncoder</span><span class=p>().</span><span class=na>username</span><span class=p>(</span><span class=s>&#34;user&#34;</span><span class=p>).</span><span class=na>password</span><span class=p>(</span><span class=s>&#34;user1234&#34;</span><span class=p>).</span><span class=na>roles</span><span class=p>(</span><span class=s>&#34;USER&#34;</span><span class=p>).</span><span class=na>build</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>User</span><span class=p>.</span><span class=na>withDefaultPasswordEncoder</span><span class=p>().</span><span class=na>username</span><span class=p>(</span><span class=s>&#34;admin&#34;</span><span class=p>).</span><span class=na>password</span><span class=p>(</span><span class=s>&#34;admin1234&#34;</span><span class=p>).</span><span class=na>roles</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>).</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>InMemoryUserDetailsManager</span><span class=p>(</span><span class=n>userDetails</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>PasswordEncoder</span><span class=w> </span><span class=nf>passwordEncoder</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>PasswordEncoderFactories</span><span class=p>.</span><span class=na>createDelegatingPasswordEncoder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div></li></ul></li><li><p>위와 같이 설정하면 User 계정과 Admin 계정을 통한 로그인이 가능해집니다.</p><blockquote><p><code>withDefaultPasswordEncoder()</code>메서드는 예제용이기 때문에 실제 프로젝트의 인증 로직에서 활용하면 취약할 수 있습니다.</p></blockquote></li></ul><h3 id=4-기본-api-생성>4. <strong>기본 API 생성</strong><a hidden class=anchor aria-hidden=true href=#4-기본-api-생성>#</a></h3><p>다음과 같이 세 가지 API가 있다고 가정하겠습니다.</p><ol><li>누구나 접근 가능한 API</li><li><code>USER</code> 권한 이상의 사용자만 접근 가능한 API</li><li><code>ADMIN</code> 권한의 사용자만 접근 가능한 API</li></ol><ul><li><p>이러한 자원을 다음과 같이 api 패키지 내부의 <code>ApiController</code>로 구현하겠습니다.</p><ul><li><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.springsecurity.jwt.api</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.GetMapping</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.RestController</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ApiController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/admin/resources&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getAdminResources</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&#34;ADMIN 자원 획득&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/user/resources&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getUserResources</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&#34;USER 자원 획득&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/public/resources&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getPublicResources</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&#34;PUBLIC 자원 획득&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div></li></ul></li></ul><blockquote><p>여기까지는 프로젝트 구조를 빠르게 잡기 위해 테스트코드를 작성하지 않았습니다. 이후부터는 <strong>TDD 스타일로 테스트를 우선 작성</strong>하고, 실제 구현을 이어나가겠습니다.</p></blockquote><h2 id=설계>설계<a hidden class=anchor aria-hidden=true href=#설계>#</a></h2><h3 id=요구사항-분석>요구사항 분석<a hidden class=anchor aria-hidden=true href=#요구사항-분석>#</a></h3><p>인증 및 인가를 사용해서 달성하려는 요구사항은 다음과 같이 3가지로 분석할 수 있습니다.</p><blockquote><p>실제로는 훨씬 많은 요구사항이 있을 수 있지만, 예제이므로 최소한의 기능만을 테스트하겠습니다.</p></blockquote><ol><li>권한이 없는 사용자가 인증이 필요한 요청 시 401 응답<code>(인증 오류)</code></li><li>권한이 부족한 사용자가 상위 권한의 요청 시 403 응답<code>(인가 오류)</code></li><li>적절한 권한이 있는 사용자는 인증이 필요한 요청 시 200 응답<code>(Happy Case)</code></li></ol><blockquote><p>TDD를 할때는 작성하기 쉬운 Happy Case보다 예외상황과 경계값 등 놓치기 쉬운 테스트케이스를 먼저 작성하는게 좋습니다.</p></blockquote><h3 id=통합테스트-작성>통합테스트 작성<a hidden class=anchor aria-hidden=true href=#통합테스트-작성>#</a></h3><p><a href=https://docs.spring.io/spring-security/reference/servlet/test/mockmvc/setup.html>다음 페이지</a>를 참고해서 위 요구사항에 맞는 통합테스트를 작성해보겠습니다.</p><blockquote><p>보통 TDD는 단위테스트로 구현되지만, <strong>외부 의존성인 Spring Security의 로직을 테스트하기 위해</strong>서는 Mocking<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>이 필수적입니다.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.springsecurity.jwt.config</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.springsecurity.jwt.api.ApiController</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.jupiter.api.BeforeEach</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.jupiter.api.DisplayName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.jupiter.api.Test</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.junit.jupiter.api.extension.ExtendWith</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.beans.factory.annotation.Autowired</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Import</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.context.ContextConfiguration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.context.junit.jupiter.SpringExtension</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.context.web.WebAppConfiguration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.web.servlet.MockMvc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.test.web.servlet.setup.MockMvcBuilders</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.context.WebApplicationContext</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.security.test.web.servlet.request.SecurityMockMvcRequestPostProcessors.user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.security.test.web.servlet.setup.SecurityMockMvcConfigurers.springSecurity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.test.web.servlet.result.MockMvcResultMatchers.status</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@ExtendWith</span><span class=p>(</span><span class=n>SpringExtension</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@ContextConfiguration</span><span class=p>(</span><span class=n>classes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SecurityConfig</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@WebAppConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Import</span><span class=p>(</span><span class=n>ApiController</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>AuthenticationTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>MockMvc</span><span class=w> </span><span class=n>mockMvc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>WebApplicationContext</span><span class=w> </span><span class=n>context</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@BeforeEach</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>init</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MockMvcBuilders</span><span class=p>.</span><span class=na>webAppContextSetup</span><span class=p>(</span><span class=n>context</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>apply</span><span class=p>(</span><span class=n>springSecurity</span><span class=p>()).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DisplayName</span><span class=p>(</span><span class=s>&#34;권한이 없는 사용자가 인증이 필요한 요청 시 401 응답(인증 오류)&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testAuthenticationError</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;/user/resources&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>401</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DisplayName</span><span class=p>(</span><span class=s>&#34; 권한이 부족한 사용자가 상위 권한의 요청 시 403 응답(인가 오류)&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testAuthorizationError</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;/admin/resources&#34;</span><span class=p>).</span><span class=na>with</span><span class=p>(</span><span class=n>user</span><span class=p>(</span><span class=s>&#34;user&#34;</span><span class=p>).</span><span class=na>roles</span><span class=p>(</span><span class=s>&#34;USER&#34;</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>403</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DisplayName</span><span class=p>(</span><span class=s>&#34;적절한 권한이 있는 사용자는 인증이 필요한 요청 시 200 응답(Happy Case)&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>testHappyCase</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 권한 없는 사용자 -&gt; Public API</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;/public/resources&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>200</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// User -&gt; User API</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;/user/resources&#34;</span><span class=p>).</span><span class=na>with</span><span class=p>(</span><span class=n>user</span><span class=p>(</span><span class=s>&#34;user&#34;</span><span class=p>).</span><span class=na>roles</span><span class=p>(</span><span class=s>&#34;USER&#34;</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>200</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Admin -&gt; User API</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;/user/resources&#34;</span><span class=p>).</span><span class=na>with</span><span class=p>(</span><span class=n>user</span><span class=p>(</span><span class=s>&#34;admin&#34;</span><span class=p>).</span><span class=na>roles</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>200</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Admin -&gt; Admin API</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mockMvc</span><span class=p>.</span><span class=na>perform</span><span class=p>(</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;/admin/resources&#34;</span><span class=p>).</span><span class=na>with</span><span class=p>(</span><span class=n>user</span><span class=p>(</span><span class=s>&#34;admin&#34;</span><span class=p>).</span><span class=na>roles</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>andExpect</span><span class=p>(</span><span class=n>status</span><span class=p>().</span><span class=na>is</span><span class=p>(</span><span class=n>200</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>위와 같이 <code>mockMvc</code>의 <code>perform()</code>메서드로 API 요청을 Mocking할 때, <code>with()</code>메서드의 파라미터로 <code>SecurityMockMvcRequestPostProcessors.user()</code>메서드를 사용하면 임시 사용자를 만들어 권한을 설정할 수 있습니다.</p></blockquote><h2 id=구현>구현<a hidden class=anchor aria-hidden=true href=#구현>#</a></h2><p>위에서 작성한 테스트를 실행해보면 인증 테스트는 통과하지만, 인가 테스트와 Happy Case가 실패합니다.</p><blockquote><p>현재 인증 관련 로직을 작성하지는 않았지만, Spring Security 의존성을 추가하면 <strong>자동으로 인증 관련 로직이 추가</strong>되기 때문에 모든 요청에서 401오류가 발생하여 첫번째 테스트가 통과합니다.</p></blockquote><p><img alt="테스트 실패" loading=lazy src=/posts/spring_security/4/test_failure.png></p><h3 id=api별-권한-부여>API별 권한 부여<a hidden class=anchor aria-hidden=true href=#api별-권한-부여>#</a></h3><p>먼저, API별로 필요한 권한을 설정하기 위해 다음과 같이 <code>SecurityConfig</code>를 수정합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/* 생략 */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>SecurityFilterChain</span><span class=w> </span><span class=nf>filterChain</span><span class=p>(</span><span class=n>HttpSecurity</span><span class=w> </span><span class=n>http</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>authorizeHttpRequests</span><span class=p>(</span><span class=n>authorize</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>authorize</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=c1>// Public API는 모든 요청에 허용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/public/**&#34;</span><span class=p>).</span><span class=na>permitAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=c1>// User API는 USER 권한 필요</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/user/**&#34;</span><span class=p>).</span><span class=na>hasRole</span><span class=p>(</span><span class=s>&#34;USER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=c1>// Admin API는 ADMIN 권한 필요</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/admin/**&#34;</span><span class=p>).</span><span class=na>hasRole</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>formLogin</span><span class=p>(</span><span class=n>Customizer</span><span class=p>.</span><span class=na>withDefaults</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// MockMVC에서 HandlerMappingIntrospector를 사용하기 위함</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;mvcHandlerMappingIntrospector&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>HandlerMappingIntrospector</span><span class=w> </span><span class=nf>mvcHandlerMappingIntrospector</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HandlerMappingIntrospector</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/* 생략 */</span><span class=w>
</span></span></span></code></pre></div><blockquote><p><code>mvcHandlerMappingIntrospector</code>를 Bean으로 등록한 이유는 <code>MockMvc</code>가 실행될 때 해당 Bean이 없으면 <code>requestMatcher</code>를 정상적으로 실행하지 못하기 때문입니다.<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup></p></blockquote><ul><li>다시 테스트를 실행해보면, 다음과 같이 2번째(인가) 테스트 케이스만 성공하는 것을 확인할 수 있습니다.
<img alt="테스트 실패 2" loading=lazy src=/posts/spring_security/4/test_failure2.png></li><li><strong>1번(인증) 테스트가 실패하는 원인</strong>은 <code>SecurityFilterChain</code>에 필요한 권한이 설정되었지만, Spring Security의 기본 정책 상 권한이 부족할 경우 로그인 페이지로 이동하는 302를 응답하기 때문입니다.</li><li><strong>3번(Happy Case) 테스트가 실패하는 원인</strong>은 ADMIN 역할이 USER 역할을 갖고 있지 않기 때문에 User API에 접근할 권한이 없기 때문에 403을 응답하기 때문입니다.</li></ul><h3 id=authenticationentrypoint-설정>AuthenticationEntryPoint 설정<a hidden class=anchor aria-hidden=true href=#authenticationentrypoint-설정>#</a></h3><p>1번(인증) 테스트를 성공하기 위해 권한이 부족할 경우 401 응답을 보내도록 <code>AuthenticationEntryPoint</code>를 수정하겠습니다.<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>SecurityFilterChain</span><span class=w> </span><span class=nf>filterChain</span><span class=p>(</span><span class=n>HttpSecurity</span><span class=w> </span><span class=n>http</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>authorizeHttpRequests</span><span class=p>(</span><span class=n>authorize</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>authorize</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/public/**&#34;</span><span class=p>).</span><span class=na>permitAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/user/**&#34;</span><span class=p>).</span><span class=na>hasRole</span><span class=p>(</span><span class=s>&#34;USER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/admin/**&#34;</span><span class=p>).</span><span class=na>hasRole</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>formLogin</span><span class=p>(</span><span class=n>Customizer</span><span class=p>.</span><span class=na>withDefaults</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>exceptionHandling</span><span class=p>(</span><span class=n>handler</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>handler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>authenticationEntryPoint</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>CustomAuthenticationEntryPoint</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>CustomAuthenticationEntryPoint</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>AuthenticationEntryPoint</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>commence</span><span class=p>(</span><span class=n>HttpServletRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>HttpServletResponse</span><span class=w> </span><span class=n>response</span><span class=p>,</span><span class=w> </span><span class=n>AuthenticationException</span><span class=w> </span><span class=n>authException</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=p>,</span><span class=w> </span><span class=n>ServletException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>response</span><span class=p>.</span><span class=na>setCharacterEncoding</span><span class=p>(</span><span class=s>&#34;UTF-8&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>response</span><span class=p>.</span><span class=na>sendError</span><span class=p>(</span><span class=n>401</span><span class=p>,</span><span class=w> </span><span class=s>&#34;인증 오류&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>다시 테스트를 실행해보면, 다음과 같이 1, 2번째(인가) 테스트 케이스가 성공하는 것을 확인할 수 있습니다.</li></ul><p><img alt="테스트 실패 3" loading=lazy src=/posts/spring_security/4/test_failure3.png></p><h3 id=rolehierarchy-설정>RoleHierarchy 설정<a hidden class=anchor aria-hidden=true href=#rolehierarchy-설정>#</a></h3><p>마지막(Happy Case) 테스트를 성공하기 위해 다음과 같이 <code>RoleHierarchy</code>(계층적 권한)을 Bean으로 등록하겠습니다.<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=n>RoleHierarchy</span><span class=w> </span><span class=nf>roleHierarchy</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>RoleHierarchyImpl</span><span class=p>.</span><span class=na>withDefaultRolePrefix</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>role</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>).</span><span class=na>implies</span><span class=p>(</span><span class=s>&#34;USER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li>다시 테스트를 실행해보면, 드디어 모든 테스트가 성공합니다!</li></ul><p><img alt="테스트 성공" loading=lazy src=/posts/spring_security/4/test_success.png></p><h2 id=결론>결론<a hidden class=anchor aria-hidden=true href=#결론>#</a></h2><p>지금까지 예제 프로젝트를 생성 후, 인증과 인가 요구사항을 통합테스트로 작성하고 모든 요구사항을 달성했습니다.</p><ul><li>해당 프로젝트의 전체 코드는 <a href=https://github.com/leaf-nam/spring_security_example>다음 깃허브 링크</a>에서 확인하실 수 있습니다.</li></ul><blockquote><p>다음 포스팅에서는 현재 프로젝트에 JWT를 활용한 인증 및 인가를 도입해보겠습니다.</p></blockquote><h3 id=다음-포스팅>다음 포스팅<a hidden class=anchor aria-hidden=true href=#다음-포스팅>#</a></h3><ul><li><a href=https://1eaf.site/posts/spring_security/5>[Java]Spring Security(With TDD) JWT 구현하기</a></li></ul><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><table><thead><tr><th style=text-align:left>URL</th><th style=text-align:left>게시일자</th><th style=text-align:left>방문일자</th><th style=text-align:left>작성자</th></tr></thead><tbody><tr><td style=text-align:left><a href=https://docs.spring.io/spring-security/reference/servlet/authentication/passwords>Spring 공식문서</a></td><td style=text-align:left>-</td><td style=text-align:left>2024.12.06.</td><td style=text-align:left>Spring</td></tr><tr><td style=text-align:left><a href=https://datatracker.ietf.org/doc/html/rfc7519>RFC 7519</a></td><td style=text-align:left>2015.05.</td><td style=text-align:left>2024.12.06.</td><td style=text-align:left>IETF</td></tr><tr><td style=text-align:left><a href=https://ko.wikipedia.org/wiki/%EB%AA%A8%EC%9D%98_%EA%B0%9D%EC%B2%B4>모의 객체</a></td><td style=text-align:left>2024.05.16.</td><td style=text-align:left>2024.12.07.</td><td style=text-align:left>Wikipedia</td></tr><tr><td style=text-align:left><a href=https://github.com/spring-projects/spring-framework/issues/20848>Spring 이슈 20848</a></td><td style=text-align:left>2017.12.14.</td><td style=text-align:left>2024.12.07.</td><td style=text-align:left>spring-projects-issues</td></tr></tbody></table><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><code>Test Driven Development</code>의 준말로, 단위 테스트를 먼저 작성한 후 구현하는 방식의 개발 방법론입니다.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><code>One Time Token</code>의 준말로, 1회성 토큰을 뜻합니다. 웹에서 회원가입을 할 때, 이메일이나 문자로 받는 토큰이 여기에 해당합니다.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://ko.wikipedia.org/wiki/%EB%AA%A8%EC%9D%98_%EA%B0%9D%EC%B2%B4>모의 객체</a>를 생성하여 테스트하는 것을 말합니다.</p><blockquote><p>실제 모듈을 사용하는 테스트는 변경에 취약하고 깨지기 쉬울 뿐 아니라 내부 로직을 잘 이해하지 못하면 작성이 어렵기 때문에, 외부 의존성에는 Mocking을 활용하여 효율적으로 테스트할 수 있습니다.</p></blockquote>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></li><li id=fn:4><p>관련 내용은 <a href=https://github.com/spring-projects/spring-framework/issues/20848>다음 이슈</a>를 참고하시기 바랍니다.</p><blockquote><p>원래 테스트를 성공시키기 위해 설정 코드를 추가하는 것은 바람직하지 않으나, 아직은 프로젝트 규모가 크지 않고 테스트에 집중하기 위해 별도의 테스트 설정 파일을 생성하지는 않았습니다.</p></blockquote>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></li><li id=fn:5><p><code>AuthenticationEntryPoint</code>에 대한 자세한 설명은 <a href=https://1eaf.site/posts/spring_security/2/#authenticationexception>인증 오류 관련 이전 포스팅</a>을 참고바랍니다.&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><code>RoleHierarchy</code>에 대한 자세한 설명은 <a href=https://1eaf.site/posts/spring_security/3/#%EA%B3%84%EC%B8%B5%EC%A0%81-%EC%97%AD%ED%95%A0hierarchical-roles>인가 관련 이전 포스팅</a>을 참고바랍니다.&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://1eaf.site/tags/authentication/>Authentication</a></li><li><a href=https://1eaf.site/tags/jwt/>Jwt</a></li></ul><nav class=paginav><a class=prev href=https://1eaf.site/posts/spring_security/5/><span class=title>« 이전 페이지</span><br><span>[Java]Spring Security(With TDD) JWT 구현하기</span>
</a><a class=next href=https://1eaf.site/cote/programmers_72412/><span class=title>다음 페이지 »</span><br><span>[Java]Programmers 순위 검색(2021 KAKAO BLIND RECRUITMENT)</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share [Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기 on x" href="https://x.com/intent/tweet/?text=%5bJava%5dSpring%20Security%28With%20TDD%29%20%ea%b8%b0%eb%b3%b8%20%ec%9d%b8%ec%a6%9d%20%eb%b0%8f%20%ec%9d%b8%ea%b0%80%20%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0&amp;url=https%3a%2f%2f1eaf.site%2fposts%2fspring_security%2f4%2f&amp;hashtags=authentication%2cjwt"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2f1eaf.site%2fposts%2fspring_security%2f4%2f&amp;title=%5bJava%5dSpring%20Security%28With%20TDD%29%20%ea%b8%b0%eb%b3%b8%20%ec%9d%b8%ec%a6%9d%20%eb%b0%8f%20%ec%9d%b8%ea%b0%80%20%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0&amp;summary=%5bJava%5dSpring%20Security%28With%20TDD%29%20%ea%b8%b0%eb%b3%b8%20%ec%9d%b8%ec%a6%9d%20%eb%b0%8f%20%ec%9d%b8%ea%b0%80%20%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0&amp;source=https%3a%2f%2f1eaf.site%2fposts%2fspring_security%2f4%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2f1eaf.site%2fposts%2fspring_security%2f4%2f&title=%5bJava%5dSpring%20Security%28With%20TDD%29%20%ea%b8%b0%eb%b3%b8%20%ec%9d%b8%ec%a6%9d%20%eb%b0%8f%20%ec%9d%b8%ea%b0%80%20%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2f1eaf.site%2fposts%2fspring_security%2f4%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기 on whatsapp" href="https://api.whatsapp.com/send?text=%5bJava%5dSpring%20Security%28With%20TDD%29%20%ea%b8%b0%eb%b3%b8%20%ec%9d%b8%ec%a6%9d%20%eb%b0%8f%20%ec%9d%b8%ea%b0%80%20%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0%20-%20https%3a%2f%2f1eaf.site%2fposts%2fspring_security%2f4%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기 on telegram" href="https://telegram.me/share/url?text=%5bJava%5dSpring%20Security%28With%20TDD%29%20%ea%b8%b0%eb%b3%b8%20%ec%9d%b8%ec%a6%9d%20%eb%b0%8f%20%ec%9d%b8%ea%b0%80%20%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0&amp;url=https%3a%2f%2f1eaf.site%2fposts%2fspring_security%2f4%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [Java]Spring Security(With TDD) 기본 인증 및 인가 구현하기 on ycombinator" href="https://news.ycombinator.com/submitlink?t=%5bJava%5dSpring%20Security%28With%20TDD%29%20%ea%b8%b0%eb%b3%b8%20%ec%9d%b8%ec%a6%9d%20%eb%b0%8f%20%ec%9d%b8%ea%b0%80%20%ea%b5%ac%ed%98%84%ed%95%98%ea%b8%b0&u=https%3a%2f%2f1eaf.site%2fposts%2fspring_security%2f4%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://utteranc.es/client.js repo=leaf-nam/leaf-nam.github.io issue-term=title theme=boxy-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://1eaf.site/>봄을 기다리는 낙엽</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="복사";function s(){t.innerHTML="복사 완료!",setTimeout(()=>{t.innerHTML="복사"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>